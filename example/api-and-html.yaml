# API and HTML Transformation Example for Go-Trust TSL Pipeline
# This example demonstrates how to:
# 1. Load TSLs and set them up for API access
# 2. Transform TSLs to HTML for web presentation
# 3. Generate an index page
# 4. Create different certificate pools with different filtering criteria

# Step 1: Set fetch options for comprehensive TSL loading
- set-fetch-options:
    - max-depth:2                                      # Follow references up to 2 levels deep
    - user-agent:Go-Trust/1.0 API Server               # Identify your client
    - timeout:60s                                      # Longer timeout for tree processing

# Step 2: Load the root TSL (EU List of Lists)
- load:
    - https://ec.europa.eu/tools/lotl/eu-lotl.xml
  
# Step 3: Log information about the loaded TSLs
- log:
    - "Loaded TSLs for API access"
  
# Step 4: Create a certificate pool for API validation
# This is a critical step for making certificates available via the API
- select:
    - include-referenced                           # Include certificates from referenced TSLs
      
# Step 5: Transform TSLs to HTML for web presentation
# Uses the embedded stylesheet tsl-to-html.xslt
- transform:
    - embedded:tsl-to-html.xslt                   # Use the embedded XSLT stylesheet
    - ./output/html                                # Output directory for HTML files
    - html                                         # Output file extension
      
# Step 6: Generate an index page for the HTML files
- generate_index:
    - ./output/html                                # Directory containing HTML files
    - "Trust Service Lists - HTML View"              # Title for the index page
      
# Step 7: Create a specialized certificate pool with filtering
# This example creates a pool with only qualified certificates
- select:
    - service-type:http://uri.etsi.org/TrstSvc/Svctype/CA/QC  # QC certificates
    - status-logic:and                             # Require all conditions to match
    - status:http://uri.etsi.org/TrstSvc/TrustedList/Svcstatus/granted  # Only granted
      
# Step 8: Log API readiness
- log:
    - "API ready with filtered certificate pool for validation"